# Subliminal Master 项目规则文档

> 最后更新：2026-02-21
> 版本：v3.4.0

---

## 一、项目概述

### 1.1 项目名称
**Subliminal Master - 潜意识音频合成引擎**

### 1.2 项目目标
创建一个专业的潜意识音频合成工具，支持：
- 高频调制处理（17.5kHz-19.5kHz）
- Theta波双耳搏动生成（4-8Hz差频）
- 无损WAV导出
- Web界面操作

### 1.3 核心原则 ⭐
- **个人工具**：主要供自己使用，不需要复杂的安全限制
- **方便好用**：主打用户体验，简单直接
- **功能优先**：优先考虑功能完善，而非安全加固
- **不需要**：CSRF保护、频率限制、并发控制等复杂安全措施

### 1.4 技术栈
- **后端**: Python 3.x + Flask
- **音频处理**: pydub + numpy + scipy
- **前端**: HTML5 + CSS3 + JavaScript (原生)
- **部署**: Docker + Render

---

## 二、代码规范

### 2.1 语言要求
- **对话语言**: 中文
- **代码注释**: 中文
- **文档**: 中文为主，英文为辅
- **系统**: Windows

### 2.2 代码风格
- 函数必须有文档字符串注释
- 使用 UTF-8 编码
- 遵循 PEP 8 规范
- 不添加多余注释，保持代码简洁

### 2.3 文件命名
- Python 文件使用下划线命名法：`audio_processor.py`
- 模板文件使用小写：`index.html`
- 配置文件：`config.py`

---

## 三、功能规范

### 3.1 核心功能
1. **音频上传**
   - 支持格式：MP3, WAV, M4A, AAC, FLAC
   - 最大文件大小：200MB
   - 支持批量上传

2. **音频处理**
   - 高频调制：15000-20000Hz 可调
   - 双耳搏动：200-500Hz 基频
   - 音量控制：-40 到 10 dB

3. **导出格式**
   - 无损 WAV 格式
   - 44100Hz 采样率
   - 16bit 深度

### 3.2 界面规范
- 使用新拟态（Neumorphism）设计风格
- 配色：紫色主色调 (#6c5ce7)
- 响应式布局，支持移动端

### 3.3 用户体验
- 上传后提供音频预览
- 处理过程显示真实进度
- 支持取消操作
- 友好的错误提示

---

## 四、安全规范

### 4.1 文件安全
- 后端必须验证文件大小
- 验证文件扩展名
- 验证 MIME 类型
- 文件名添加 UUID 唯一前缀

### 4.2 路径安全
- 使用 `secure_filename` 处理文件名
- 验证路径不越界
- 不返回敏感路径信息

### 4.3 错误处理
- 不返回详细异常信息给前端
- 使用友好错误消息字典
- 详细错误记录到日志

---

## 五、性能规范

### 5.1 音频处理
- 使用乘法代替循环拼接音频
- 时间复杂度优化：O(n²) → O(n)

### 5.2 文件管理
- 自动清理过期文件（24小时）
- 限制最大文件数量（100个）
- 后台定时清理

### 5.3 前端性能
- 使用 localStorage 缓存预设
- 避免重复请求

---

## 六、部署规范

### 6.1 环境变量
支持以下环境变量配置：
```
HOST=0.0.0.0
PORT=5000
FLASK_DEBUG=False
UPLOAD_FOLDER=uploads
OUTPUT_FOLDER=output
LOG_FOLDER=logs
LOG_LEVEL=INFO
FILE_CLEANUP_HOURS=24
MAX_UPLOAD_FILES=100
```

### 6.2 Docker 部署
- 使用 Dockerfile 构建
- 预装 ffmpeg
- 暴露端口 5000

### 6.3 Render 部署
- 使用 render.yaml 配置
- Docker 构建模式
- 自动部署 main 分支

---

## 七、测试规范

### 7.1 单元测试
- 使用 pytest 框架
- 使用 mock 模拟外部依赖
- 不依赖外部音频文件

### 7.2 测试覆盖
- 音频处理函数
- 文件验证函数
- 配置管理
- 错误处理

---

## 八、版本规范

### 8.1 版本号格式
`主版本.次版本.修订版本` (如 3.4.0)

### 8.2 版本更新类型
- **主版本**: 重大架构变更
- **次版本**: 新功能添加
- **修订版本**: Bug修复、优化

### 8.3 提交信息格式
```
v版本号: 简短描述

功能增强:
- 新增功能1
- 新增功能2

修复:
- 修复问题1
- 修复问题2

优化:
- 优化项1
```

---

## 九、文档规范

### 9.1 必要文档
- README.md: 项目说明
- 代码审查报告.md: 问题追踪
- project_rules.md: 项目规则（本文件）

### 9.2 文档更新规则
- 每次功能更新后更新相关文档
- 代码审查报告记录所有修复状态
- 项目规则持续更新

---

## 十、智能体工作模式

### 10.1 自主工作原则
- AI 主动完成整个工作闭环
- 发现问题 → 检查错误 → 提出方案 → 执行修复 → 验证结果
- 不等待进一步指令

### 10.2 界面验证要求
- 修复后必须打开预览验证
- 逐个测试所有功能模块
- 有问题就修复，直到没有问题

### 10.3 问题修复标准
- 完成标志：明确告知"成功了"
- 避免重复修复同一问题
- 从架构层面思考根本原因

---

## 十一、持续更新规则

### 11.1 规则更新
- 根据对话内容持续更新本文件
- 新的要求、规范、标准及时添加
- 优化建议记录在案

### 11.2 文档同步
- 代码更新后同步更新文档
- 版本号保持一致
- 功能变更记录在版本日志

### 11.3 问题追踪
- 使用代码审查报告追踪问题
- 标记修复状态
- 记录解决方案

---

## 十二、预设配置

### 12.1 内置预设
| 预设名称 | 载波频率 | 潜意识音量 | 背景音量 | Theta差频 |
|----------|----------|------------|----------|-----------|
| 默认配置 | 17500Hz | -23dB | 0dB | 4Hz |
| 深度冥想 | 17500Hz | -25dB | -5dB | 4Hz |
| 专注学习 | 18000Hz | -20dB | -3dB | 10Hz |
| 助眠放松 | 17500Hz | -28dB | -8dB | 4Hz |

### 12.2 自定义预设
- 用户可保存自定义预设
- 存储在 localStorage
- 下次访问自动加载

---

## 十三、API 规范

### 13.1 接口列表
| 接口 | 方法 | 说明 |
|------|------|------|
| `/` | GET | 主页 |
| `/process` | POST | 处理音频 |
| `/download/<filename>` | GET | 下载文件 |
| `/health` | GET | 健康检查 |
| `/api/config` | GET | 获取配置 |
| `/api/history` | GET | 获取历史记录 |

### 13.2 响应格式
```json
{
    "success": true/false,
    "data": {...},
    "error": "错误消息"
}
```

---

## 十四、已知限制

### 14.1 当前限制
- 最大文件大小：200MB
- 最大历史记录：50条
- 文件保留时间：24小时

### 14.2 待优化项
- 大文件分块处理（暂无需求）
- 多语言支持（暂无需求）

---

*本文档将根据项目发展持续更新。*
